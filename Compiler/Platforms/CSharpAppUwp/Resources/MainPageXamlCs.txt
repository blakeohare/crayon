using Microsoft.Graphics.Canvas;
using Microsoft.Graphics.Canvas.Effects;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Numerics;
using System.Runtime.InteropServices.WindowsRuntime;
using Windows.Foundation;
using Windows.Foundation.Collections;
using Windows.UI;
using Windows.UI.Xaml;
using Windows.UI.Xaml.Controls;
using Windows.UI.Xaml.Controls.Primitives;
using Windows.UI.Xaml.Data;
using Windows.UI.Xaml.Input;
using Windows.UI.Xaml.Media;
using Windows.UI.Xaml.Navigation;

// The Blank Page item template is documented at https://go.microsoft.com/fwlink/?LinkId=402352&clcid=0x409

namespace %%%PROJECT_ID%%%
{
	/// <summary>
	/// An empty page that can be used on its own or navigated to within a Frame.
	/// </summary>
	public sealed partial class MainPage : Page
	{
		public MainPage()
		{
			this.InitializeComponent();
		}

		void Page_Unloaded(object sender, RoutedEventArgs e)
		{
			this.canvas.RemoveFromVisualTree();
			this.canvas = null;
		}
		private int lifetimeCounter = 0;

		private static readonly int WIDTH = 640;
		private static readonly int HEIGHT = 480;

		private void canvas_DrawAnimated(
			Microsoft.Graphics.Canvas.UI.Xaml.ICanvasAnimatedControl sender,
			Microsoft.Graphics.Canvas.UI.Xaml.CanvasAnimatedDrawEventArgs args)
		{
			System.Diagnostics.Debug.WriteLine(lifetimeCounter++) ;
			args.DrawingSession.DrawText(
				"Hello, World!",
				new Vector2(lifetimeCounter % WIDTH, lifetimeCounter % HEIGHT), 
				Color.FromArgb(255, 255, 0, 0));
			
			args.DrawingSession.FillEllipse(
				new Vector2((lifetimeCounter * 2) % WIDTH, (lifetimeCounter * 3 / 2 % HEIGHT)), 
				50,  100,
				Color.FromArgb(255, 0, 0, 255));

			args.DrawingSession.FillRectangle(
				new Rect(300, 100, 50, 70), Color.FromArgb(255, 0, 128, 255));
			//args.DrawingSession.DrawLine(RndPosition(), RndPosition(), Color.FromArgb(255, RndByte(), RndByte(), RndByte()));
			
		}

		Random rnd = new Random();

		private Vector2 RndPosition()
		{
			double x = rnd.NextDouble() * 500f;
			double y = rnd.NextDouble() * 500f;
			return new Vector2((float)x, (float)y);
		}

		private float RndRadius()
		{
			return (float)rnd.NextDouble() * 150f;
		}

		private byte RndByte()
		{
			return (byte)rnd.Next(256);
		}
	}
}
